<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>For Evan â€” SVG bubble & roses</title>
<style>
  :root{ --bg:#fff6f8; --accent:#d63384; --muted:#6b7280; --shadow: rgba(10,10,20,0.08); }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);display:flex;align-items:center;justify-content:center}
  .card{width:min(980px,96vw);height:min(760px,88vh);border-radius:14px;background:linear-gradient(180deg,#fff,#fff6f8);box-shadow:0 22px 48px var(--shadow);padding:24px;display:flex;flex-direction:column;align-items:center;gap:12px}
  .canvasWrap{ width:100%; flex:1; display:flex; align-items:center; justify-content:center; }
  h1{margin:6px 0 0 0; font-size:20px; color:#3a2b33 }
  .name{ color:var(--accent); font-size:30px; font-weight:700; margin:2px 0 8px }
  .hint{ color:var(--muted); margin:0 0 6px; text-align:center }
  button.btn{ margin-top:6px; padding:10px 14px; border-radius:10px; border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer }

  /* SVG: make pointer handling explicit so clicks reach groups */
  svg { width:95%; height:95%; }
  svg * { transform-box: fill-box; transform-origin: center; pointer-events: visiblePainted; }

  /* petals, stems */
  .petal { filter: drop-shadow(0 6px 10px rgba(0,0,0,0.06)); transition: transform 380ms ease; }
  .flower:hover .petal { transform: scale(1.03); }
  .flower:active .petal { transform: scale(.96) rotate(2deg); }

  .stem { stroke:#2b6b3a; stroke-width:5; stroke-linecap:round; fill:none; }

  /* flower float */
  .flower { animation: flowerFloat 6.5s ease-in-out infinite; cursor:pointer; }
  @keyframes flowerFloat { 0%{transform:translateY(0)} 50%{transform:translateY(-6px)} 100%{transform:translateY(0)} }

  /* SVG bubble styles (animated via CSS class on group) */
  .svg-bubble { transform-origin: center bottom; opacity:0; transition: transform .28s cubic-bezier(.2,.9,.3,1), opacity .28s ease; }
  .svg-bubble.show { transform: translateY(-6px) scale(1); opacity:1; }
  .svg-bubble.hide { transform: translateY(6px) scale(.96); opacity:0; }

  /* hearts (DOM elements) */
  .heart { position:fixed; pointer-events:none; font-size:18px; opacity:0.95; z-index:1100; }

  @media (max-width:920px){
    .card{padding:16px}
  }
</style>
</head>
<body>
  <div class="card" role="main">
    <div class="canvasWrap">
      <!-- BIG SVG: everything (flowers, vase, bubble) drawn inside so bubble can be anchored precisely -->
      <svg id="svg" viewBox="0 0 1000 700" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Rose bouquet">
        <defs>
          <radialGradient id="petGrad1" cx="30%" cy="30%"><stop offset="0%" stop-color="#ffdfe6"/><stop offset="60%" stop-color="#ff7f9a"/><stop offset="100%" stop-color="#d64b6d"/></radialGradient>
          <radialGradient id="petGrad2" cx="30%" cy="30%"><stop offset="0%" stop-color="#fff1e6"/><stop offset="60%" stop-color="#ff9aa6"/><stop offset="100%" stop-color="#d45b78"/></radialGradient>
          <radialGradient id="centerG" cx="40%" cy="40%"><stop offset="0%" stop-color="#fff8d8"/><stop offset="100%" stop-color="#ffd166"/></radialGradient>
          <linearGradient id="vaseGrad" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#ffffff" stop-opacity="0.98"/><stop offset="100%" stop-color="#ffeef6"/></linearGradient>
        </defs>

        <!-- vase baseline -->
        <g id="vase" transform="translate(500,470)">
          <ellipse cx="0" cy="36" rx="220" ry="30" fill="rgba(0,0,0,0.06)"></ellipse>
          <path d="M-160 12 C-120 160 120 160 160 12 L140 240 C70 280 -70 280 -140 240 Z" fill="url(#vaseGrad)"></path>
        </g>

        <!-- Flowers (three) -->
        <g class="flower" transform="translate(330,300)" data-name="left">
          <path class="stem" d="M0 6 C -10 48 -12 120 160 226"></path>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad1)" transform="rotate(-54)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad2)" transform="rotate(18)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad1)" transform="rotate(90)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad2)" transform="rotate(162)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad1)" transform="rotate(234)"></ellipse>
          <circle cx="0" cy="-10" r="12" fill="url(#centerG)"></circle>
        </g>

        <g class="flower" transform="translate(500,260)" data-name="center">
          <path class="stem" d="M0 10 C -8 70 -16 150 0 240"></path>
          <ellipse class="petal" rx="66" ry="38" cx="0" cy="-48" fill="url(#petGrad2)" transform="rotate(-54)"></ellipse>
          <ellipse class="petal" rx="66" ry="38" cx="0" cy="-48" fill="url(#petGrad1)" transform="rotate(18)"></ellipse>
          <ellipse class="petal" rx="66" ry="38" cx="0" cy="-48" fill="url(#petGrad2)" transform="rotate(90)"></ellipse>
          <ellipse class="petal" rx="66" ry="38" cx="0" cy="-48" fill="url(#petGrad1)" transform="rotate(162)"></ellipse>
          <ellipse class="petal" rx="66" ry="38" cx="0" cy="-48" fill="url(#petGrad2)" transform="rotate(234)"></ellipse>
          <circle cx="0" cy="-12" r="16" fill="url(#centerG)"></circle>
        </g>

        <g class="flower" transform="translate(670,300)" data-name="right">
          <path class="stem" d="M0 6 C -6 64 -36 120 -120 226"></path>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad1)" transform="rotate(-54)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad2)" transform="rotate(18)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad1)" transform="rotate(90)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad2)" transform="rotate(162)"></ellipse>
          <ellipse class="petal" rx="52" ry="30" cx="0" cy="-36" fill="url(#petGrad1)" transform="rotate(234)"></ellipse>
          <circle cx="0" cy="-10" r="12" fill="url(#centerG)"></circle>
        </g>

        <!-- SVG speech-bubble group (hidden until shown) -->
        <g id="svgBubble" class="svg-bubble hide" transform="translate(500,150)" opacity="0">
          <!-- rounded rect bubble -->
          <rect x="-160" y="-90" rx="12" ry="12" width="320" height="84" fill="#fff" stroke="rgba(0,0,0,0.04)" />
          <!-- tail triangle (simple) -->
          <path d="M-24  -6 L0 18 L24 -6 Z" fill="#fff" stroke="rgba(0,0,0,0.03)"></path>
          <!-- text (wrapped approx by manual tspans) -->
          <text id="bubbleText" x="0" y="-46" font-family="Inter, system-ui, Arial" font-size="14" fill="#35272f" text-anchor="middle">
            <tspan id="line1" x="0" dy="0">Hello</tspan>
            <tspan id="line2" x="0" dy="18"></tspan>
            <tspan id="line3" x="0" dy="18"></tspan>
          </text>
          <!-- close "button" (SVG rect clickable) -->
          <g id="bubbleClose" transform="translate(0,20)" style="cursor:pointer">
            <rect x="-42" y="0" rx="8" ry="8" width="84" height="28" fill="#d63384" />
            <text x="0" y="19" font-family="Inter, system-ui, Arial" font-size="13" fill="#fff" text-anchor="middle">Close</text>
          </g>
        </g>

      </svg>
    </div>

    <h1>For</h1>
    <div class="name" id="recipient">Evan</div>
    <p class="hint">Click any rose and the message will appear from the flower itself.</p>
    <button class="btn" id="surpriseBtn">Surprise Now</button>
  </div>

<script>
  // CONFIG
  const recipientName = "Evan";
  const surpriseLines = [
    "Roses are lovely, violets are true â€”",
    "every moment sparkles more with you.",
    "Will you be my Valentine?"
  ];
  document.getElementById('recipient').textContent = recipientName;

  // utils: map client (mouse) coordinates to SVG coords
  const svg = document.getElementById('svg');
  function clientToSvgPoint(clientX, clientY){
    const pt = svg.createSVGPoint();
    pt.x = clientX; pt.y = clientY;
    const ctm = svg.getScreenCTM();
    if(!ctm) return {x:clientX,y:clientY};
    const inv = ctm.inverse();
    const loc = pt.matrixTransform(inv);
    return { x: loc.x, y: loc.y };
  }

  // show bubble at svg coords (sx, sy) - positions bubble group so tail points to the flower
  const svgBubble = document.getElementById('svgBubble');
  const bubbleTextEls = {
    line1: document.getElementById('line1'),
    line2: document.getElementById('line2'),
    line3: document.getElementById('line3')
  };
  function setBubbleText(lines){
    bubbleTextEls.line1.textContent = lines[0] || "";
    bubbleTextEls.line2.textContent = lines[1] || "";
    bubbleTextEls.line3.textContent = lines[2] || "";
  }

  function showSvgBubbleAtSvgCoords(sx, sy, lines){
    // position bubble above the anchor point by offsetting transform
    const bubbleX = sx; // center above flower
    const bubbleY = sy - 90; // raise it above the flower
    svgBubble.setAttribute('transform', `translate(${bubbleX}, ${bubbleY})`);
    setBubbleText(lines);
    // make visible
    svgBubble.classList.remove('hide');
    svgBubble.classList.add('show');
    svgBubble.setAttribute('opacity', '1');
  }

  function hideSvgBubble(){
    svgBubble.classList.remove('show');
    svgBubble.classList.add('hide');
    svgBubble.setAttribute('opacity', '0');
  }

  // hearts (DOM) spawn from an SVG point: convert to client pixels
  function spawnHeartsFromSvg(sx, sy, count=10){
    // convert svg point back to client coords
    const pt = svg.createSVGPoint(); pt.x = sx; pt.y = sy;
    const ctm = svg.getScreenCTM();
    const client = pt.matrixTransform(ctm);
    for(let i=0;i<count;i++){
      const h = document.createElement('div');
      h.className = 'heart';
      h.textContent = ['â¤','ðŸ’—','ðŸ’•'][Math.floor(Math.random()*3)];
      document.body.appendChild(h);
      const size = 12 + Math.random()*26;
      h.style.fontSize = size + 'px';
      // jitter start near the client point
      const left = client.x + (Math.random()*80 - 40);
      const top = client.y + (Math.random()*30 - 10);
      h.style.left = left + 'px';
      h.style.top = top + 'px';
      // animate (Web Animations)
      const dx = (Math.random()*160 - 80);
      const dy = - (120 + Math.random()*100);
      h.animate([
        { transform: 'translate(0,0) scale(1)', opacity: 1 },
        { transform: `translate(${dx}px, ${dy}px) scale(.85)`, opacity: 0 }
      ], {
        duration: 1400 + Math.random()*800,
        easing: 'cubic-bezier(.2,.9,.3,1)'
      });
      setTimeout(()=> h.remove(), 1800 + Math.random()*900);
    }
  }

  // set bubble text to surpriseLines by default
  function bubbleLinesFor(name){
    // include name on second line optionally
    return [
      surpriseLines[0],
      surpriseLines[1],
      `${surpriseLines[2]}`
    ];
  }

  // click handlers: attach to each .flower group for reliable clicks
  svg.querySelectorAll('.flower').forEach(g => {
    // use capture true to ensure we catch clicks even if some child element is picky
    g.addEventListener('click', (ev) => {
      ev.stopPropagation();
      ev.preventDefault();
      // compute svg coordinates of the group's center using bbox
      const bbox = g.getBBox();
      // group transform is applied; compute group's screen center via getBoundingClientRect for reliability
      const rect = g.getBoundingClientRect();
      const clientX = rect.left + rect.width/2;
      const clientY = rect.top + rect.height/2;
      const svgPt = clientToSvgPoint(clientX, clientY);
      showSvgBubbleAtSvgCoords(svgPt.x, svgPt.y, bubbleLinesFor(recipientName));
      spawnHeartsFromSvg(svgPt.x, svgPt.y, 10);
    }, { capture: true });
  });

  // Surprise Now button: center bubble near center flower
  document.getElementById('surpriseBtn').addEventListener('click', ()=>{
    const centerFlower = svg.querySelector('[data-name="center"]');
    const rect = centerFlower.getBoundingClientRect();
    const clientX = rect.left + rect.width/2;
    const clientY = rect.top + rect.height/2;
    const svgPt = clientToSvgPoint(clientX, clientY);
    showSvgBubbleAtSvgCoords(svgPt.x, svgPt.y, bubbleLinesFor(recipientName));
    spawnHeartsFromSvg(svgPt.x, svgPt.y, 12);
  });

  // bubble close (SVG element)
  document.getElementById('bubbleClose').addEventListener('click', (ev) => {
    ev.stopPropagation();
    hideSvgBubble();
  });

  // clicking outside removes bubble
  document.body.addEventListener('click', (ev) => {
    // if we clicked inside the svg bubble group, ignore (bubble close handles)
    if(ev.target.closest && ev.target.closest('#svgBubble')) return;
    hideSvgBubble();
  });

  // keyboard escape closes
  document.addEventListener('keydown', (e) => { if(e.key === 'Escape') hideSvgBubble(); });

  // defensive: make bubble hidden at load
  hideSvgBubble();
</script>
</body>
</html>
